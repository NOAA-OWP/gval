<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Two-Class Categorical Comparisons &mdash; GVAL  documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="_static/nbsphinx-code-cells.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="_static/jquery.js"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/sphinx_highlight.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
        <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Multi-Class Categorical Comparisons" href="SphinxMulticatTutorial.html" />
    <link rel="prev" title="Tutorials" href="tutorials.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            GVAL
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Table of Contents</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="tutorials.html">Tutorials</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">Two-Class Categorical Comparisons</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#Load-Datasets">Load Datasets</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Run-GVAL-Categorical-Compare">Run GVAL Categorical Compare</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Output">Output</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#Agreement-Map">Agreement Map</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Cross-tabulation-Table">Cross-tabulation Table</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Metric-Table">Metric Table</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#Access-to-Individual-GVAL-Operations">Access to Individual GVAL Operations</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#Pairing-Dictionary">Pairing Dictionary</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Registration-of-Custom-Functions">Registration of Custom Functions</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#Save-Output">Save Output</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="SphinxMulticatTutorial.html">Multi-Class Categorical Comparisons</a></li>
<li class="toctree-l2"><a class="reference internal" href="SphinxContinuousTutorial.html">Continuous Comparisons</a></li>
<li class="toctree-l2"><a class="reference internal" href="SphinxSubsamplingTutorial.html">Subsampling Comparisons</a></li>
<li class="toctree-l2"><a class="reference internal" href="SphinxCatalogTutorial.html">Catalog Comparisons</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="api.html">GVAL API</a></li>
<li class="toctree-l1"><a class="reference internal" href="contributing.html">Contributing</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">GVAL</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="tutorials.html">Tutorials</a></li>
      <li class="breadcrumb-item active">Two-Class Categorical Comparisons</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/SphinxTutorial.ipynb.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <p><img alt="5037082aaf0549c6ae8e823862096e1e" src="https://github.com/NOAA-OWP/gval/raw/main/docs/images/gval_light_mode.png" /></p>
<section id="Two-Class-Categorical-Comparisons">
<h1>Two-Class Categorical Comparisons<a class="headerlink" href="#Two-Class-Categorical-Comparisons" title="Permalink to this heading"></a></h1>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">rioxarray</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">rxr</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">gval</span>
</pre></div>
</div>
</div>
<section id="Load-Datasets">
<h2>Load Datasets<a class="headerlink" href="#Load-Datasets" title="Permalink to this heading"></a></h2>
<p>It is preferred to use masking and scaling by default. If your original data does not have nodata or does not have nodata assigned, please assign using: <code class="docutils literal notranslate"><span class="pre">rio.write_nodata(&lt;your_nodata_value&gt;,</span> <span class="pre">inplace=True)</span></code></p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">candidate</span> <span class="o">=</span> <span class="n">rxr</span><span class="o">.</span><span class="n">open_rasterio</span><span class="p">(</span>
    <span class="s1">&#39;candidate_map_two_class_categorical.tif&#39;</span><span class="p">,</span> <span class="n">mask_and_scale</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>
<span class="n">benchmark</span> <span class="o">=</span> <span class="n">rxr</span><span class="o">.</span><span class="n">open_rasterio</span><span class="p">(</span>
    <span class="s1">&#39;benchmark_map_two_class_categorical.tif&#39;</span><span class="p">,</span> <span class="n">mask_and_scale</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</section>
<section id="Run-GVAL-Categorical-Compare">
<h2>Run GVAL Categorical Compare<a class="headerlink" href="#Run-GVAL-Categorical-Compare" title="Permalink to this heading"></a></h2>
<p>An example of running the entire process with one command using minimal arguments is deomnstrated below.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">agreement_map</span><span class="p">,</span> <span class="n">crosstab_table</span><span class="p">,</span> <span class="n">metric_table</span> <span class="o">=</span> <span class="n">candidate</span><span class="o">.</span><span class="n">gval</span><span class="o">.</span><span class="n">categorical_compare</span><span class="p">(</span>
    <span class="n">benchmark</span><span class="p">,</span>
    <span class="n">positive_categories</span><span class="o">=</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
    <span class="n">negative_categories</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</section>
<section id="Output">
<h2>Output<a class="headerlink" href="#Output" title="Permalink to this heading"></a></h2>
<section id="Agreement-Map">
<h3>Agreement Map<a class="headerlink" href="#Agreement-Map" title="Permalink to this heading"></a></h3>
<p>The agreement map compares the encodings of the benchmark map and candidate map using a “comparison function” to then output unique encodings. In this particular case the “Szudzik” comparison function was used by default since no argument was passed in for the <code class="docutils literal notranslate"><span class="pre">comparison_function</span></code> argument. First, a negative value transformation (nvt) is used to support negative numbers encodings:</p>
<div class="math notranslate nohighlight">
\[\begin{split}c = \text{candidate value} \\
b = \text{benchmark value} \\
nvt(x)=
\begin{cases}
    2 * x,&amp; \text{if } x \geq 0\\
    -2 * x -1,              &amp; \text{otherwise}
\end{cases} \\
ct = nvt(c) \\
bt = nvt(b) \\\end{split}\]</div>
<p>Then the szudzik function is applied to the transformed values:</p>
<div class="math notranslate nohighlight">
\[\begin{split}szudzik(ct, bt)=
\begin{cases}
    ct^{2} + ct + bt,&amp; \text{if } ct\geq bt\\
    bt^{2} + ct,              &amp; \text{otherwise}
\end{cases}\end{split}\]</div>
<p>The resulting map allows a user to visualize these encodings as follows:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">agreement_map</span><span class="o">.</span><span class="n">gval</span><span class="o">.</span><span class="n">cat_plot</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;Agreement Map&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;matplotlib.collections.QuadMesh at 0x7f29fbe6d960&gt;
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/SphinxTutorial_16_1.png" src="_images/SphinxTutorial_16_1.png" />
</div>
</div>
</section>
<section id="Cross-tabulation-Table">
<h3>Cross-tabulation Table<a class="headerlink" href="#Cross-tabulation-Table" title="Permalink to this heading"></a></h3>
<p>A cross-tabulation table displays the frequency of each class in the presence of another within the spatial unit of interest. The sample indices are denoted by the band column. The combination of candidate and benchmark map values are denoted. Additionally, the resulting agreement map values for each combination are shown. The counts column denotes the frequencies of occurrence and can then be used to compute categorical metrics.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">crosstab_table</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>band</th>
      <th>candidate_values</th>
      <th>benchmark_values</th>
      <th>agreement_values</th>
      <th>counts</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>6.0</td>
      <td>10345720.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1</td>
      <td>1.0</td>
      <td>2.0</td>
      <td>18.0</td>
      <td>639227.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1</td>
      <td>2.0</td>
      <td>0.0</td>
      <td>20.0</td>
      <td>512277.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1</td>
      <td>2.0</td>
      <td>2.0</td>
      <td>24.0</td>
      <td>2473405.0</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
</section>
<section id="Metric-Table">
<h3>Metric Table<a class="headerlink" href="#Metric-Table" title="Permalink to this heading"></a></h3>
<p>A metric table contains information about the unit of analysis, (a single band in this case), and selected categorical metrics. This is done by specifying the positive and negative categories of each dataset and then choosing the statistics of interest. Since we did not provide the <code class="docutils literal notranslate"><span class="pre">metrics</span></code> argument GVAL computed all of the available categorical statistics. (Note: if there is no negative class encoding all statistics requiring true negatives will be skipped.)</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">metric_table</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>0</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>band</th>
      <td>1</td>
    </tr>
    <tr>
      <th>fn</th>
      <td>639227.0</td>
    </tr>
    <tr>
      <th>fp</th>
      <td>512277.0</td>
    </tr>
    <tr>
      <th>tn</th>
      <td>10345720.0</td>
    </tr>
    <tr>
      <th>tp</th>
      <td>2473405.0</td>
    </tr>
    <tr>
      <th>accuracy</th>
      <td>0.917577</td>
    </tr>
    <tr>
      <th>balanced_accuracy</th>
      <td>0.873727</td>
    </tr>
    <tr>
      <th>critical_success_index</th>
      <td>0.682336</td>
    </tr>
    <tr>
      <th>equitable_threat_score</th>
      <td>0.610939</td>
    </tr>
    <tr>
      <th>f_score</th>
      <td>0.811177</td>
    </tr>
    <tr>
      <th>false_discovery_rate</th>
      <td>0.171578</td>
    </tr>
    <tr>
      <th>false_negative_rate</th>
      <td>0.205365</td>
    </tr>
    <tr>
      <th>false_omission_rate</th>
      <td>0.058191</td>
    </tr>
    <tr>
      <th>false_positive_rate</th>
      <td>0.04718</td>
    </tr>
    <tr>
      <th>fowlkes_mallows_index</th>
      <td>0.811352</td>
    </tr>
    <tr>
      <th>matthews_correlation_coefficient</th>
      <td>0.758757</td>
    </tr>
    <tr>
      <th>negative_likelihood_ratio</th>
      <td>0.215534</td>
    </tr>
    <tr>
      <th>negative_predictive_value</th>
      <td>0.941809</td>
    </tr>
    <tr>
      <th>overall_bias</th>
      <td>0.959215</td>
    </tr>
    <tr>
      <th>positive_likelihood_ratio</th>
      <td>16.842723</td>
    </tr>
    <tr>
      <th>positive_predictive_value</th>
      <td>0.828422</td>
    </tr>
    <tr>
      <th>prevalence</th>
      <td>0.222798</td>
    </tr>
    <tr>
      <th>prevalence_threshold</th>
      <td>0.195925</td>
    </tr>
    <tr>
      <th>true_negative_rate</th>
      <td>0.95282</td>
    </tr>
    <tr>
      <th>true_positive_rate</th>
      <td>0.794635</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
</section>
</section>
<section id="Access-to-Individual-GVAL-Operations">
<h2>Access to Individual GVAL Operations<a class="headerlink" href="#Access-to-Individual-GVAL-Operations" title="Permalink to this heading"></a></h2>
<p>Aside form running the entire process, it is possible to run each of the following steps individually: homogenizing maps, computing an agreement map, computing a cross-tabulation table, and computing a metric table. This allows for flexibility in workflows so that a user may use as much or as little functionality as needed.</p>
<p>Homogenization is intended to help prepare two disparate maps for comparison. Currently, homogenization handles three sets of functionality:</p>
<ol class="arabic simple">
<li><p><em>Spatial alignment:</em> matching the CRS’s and coordinates of candidate and benchmark xarray maps. By default, the benchmark map is used as the target of this alignment but the candidate map can also be selected.</p></li>
<li><p><em>Data type alignment:</em> in order to avoid precision warnings in the comparisons, dtypes are set to the highest precision dtype of the two maps.</p></li>
<li><p><em>Data format conversion:</em> a vector data format benchmark map as a Geopanda’s DataFrame can be passed which will be converted to the same xarray object as the candidate map with the same CRS and coordinates.</p></li>
</ol>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">candidate</span><span class="p">,</span> <span class="n">benchmark</span> <span class="o">=</span> <span class="n">candidate</span><span class="o">.</span><span class="n">gval</span><span class="o">.</span><span class="n">homogenize</span><span class="p">(</span>
    <span class="n">benchmark_map</span><span class="o">=</span><span class="n">benchmark</span><span class="p">,</span>
    <span class="n">target_map</span> <span class="o">=</span> <span class="s2">&quot;candidate&quot;</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">target_map</span></code> can also be an alternate map:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">target_map</span> <span class="o">=</span> <span class="n">rxr</span><span class="o">.</span><span class="n">open_rasterio</span><span class="p">(</span><span class="s1">&#39;target_map_two_class_categorical.tif&#39;</span><span class="p">)</span>
<span class="n">candidate</span><span class="p">,</span> <span class="n">benchmark</span> <span class="o">=</span> <span class="n">candidate</span><span class="o">.</span><span class="n">gval</span><span class="o">.</span><span class="n">homogenize</span><span class="p">(</span>
    <span class="n">benchmark_map</span><span class="o">=</span><span class="n">benchmark</span><span class="p">,</span>
    <span class="n">target_map</span> <span class="o">=</span> <span class="n">target_map</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<p>The default is to resample using the “nearest” method. Although not applicable for this case of categorical comparisons, one can change the <code class="docutils literal notranslate"><span class="pre">resampling</span></code> argument to use alternative resampling methods such as bilinear or cubic resampling. These methods would be relevant in the case of continuous datasets.</p>
<p>The “szudzik” comparison function is run by default if the <code class="docutils literal notranslate"><span class="pre">comparison_function</span></code> argument is not provided, but one may use the “cantor” pairing function, or a custom callable.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">agreement_map</span> <span class="o">=</span> <span class="n">candidate</span><span class="o">.</span><span class="n">gval</span><span class="o">.</span><span class="n">compute_agreement_map</span><span class="p">(</span>
    <span class="n">benchmark_map</span><span class="o">=</span><span class="n">benchmark</span><span class="p">,</span>
    <span class="n">comparison_function</span><span class="o">=</span><span class="s1">&#39;cantor&#39;</span>
<span class="p">)</span>

<span class="n">agreement_map</span><span class="o">.</span><span class="n">gval</span><span class="o">.</span><span class="n">cat_plot</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;Agreement Map&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;matplotlib.collections.QuadMesh at 0x7f2a16beb9d0&gt;
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/SphinxTutorial_33_1.png" src="_images/SphinxTutorial_33_1.png" />
</div>
</div>
<section id="Pairing-Dictionary">
<h3>Pairing Dictionary<a class="headerlink" href="#Pairing-Dictionary" title="Permalink to this heading"></a></h3>
<p>A pairing dictionary can be provided by the user to allow more control when specifying the agreement value outputs.</p>
<p>A pairing dictionary has keys that are tuples corresponding to every unique combination of values in the candidate and benchmark, respectively. The values represent the agreement values for each combination. An example pairing dictionary for the candidate values [1,2] and benchmark values [0, 2] is provided below. A user has full control over the encodings including the combinations of nodata values (which are in this case np.nan).</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>

<span class="n">pairing_dict</span> <span class="o">=</span> <span class="p">{</span>
    <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">):</span> <span class="mi">0</span><span class="p">,</span>
    <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="mi">0</span><span class="p">):</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span>
    <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="mi">2</span><span class="p">):</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span>
    <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">):</span> <span class="mi">3</span><span class="p">,</span>
    <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">):</span> <span class="mi">4</span><span class="p">,</span>
    <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">):</span> <span class="mi">5</span><span class="p">,</span>
    <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">):</span> <span class="mi">6</span><span class="p">,</span>
    <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">):</span> <span class="mi">7</span><span class="p">,</span>
    <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">):</span> <span class="mi">8</span>
<span class="p">}</span>

<span class="n">agreement_map</span> <span class="o">=</span> <span class="n">candidate</span><span class="o">.</span><span class="n">gval</span><span class="o">.</span><span class="n">compute_agreement_map</span><span class="p">(</span>
    <span class="n">benchmark_map</span><span class="o">=</span><span class="n">benchmark</span><span class="p">,</span>
    <span class="n">comparison_function</span><span class="o">=</span><span class="s1">&#39;pairing_dict&#39;</span><span class="p">,</span>
    <span class="n">pairing_dict</span><span class="o">=</span><span class="n">pairing_dict</span>
<span class="p">)</span>

<span class="n">agreement_map</span><span class="o">.</span><span class="n">gval</span><span class="o">.</span><span class="n">cat_plot</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;Agreement Map&quot;</span><span class="p">,</span> <span class="n">basemap</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;matplotlib.collections.QuadMesh at 0x7f2a16a4e830&gt;
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/SphinxTutorial_35_1.png" src="_images/SphinxTutorial_35_1.png" />
</div>
</div>
<p>Instead of building a pairing dictionary, a user can pass the unique candidate and benchmark values to use and a pairing dictionary will be built for the user. In this case nodata values are not included and will automatically become the nodata value instead of an encoding.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">agreement_map</span> <span class="o">=</span> <span class="n">candidate</span><span class="o">.</span><span class="n">gval</span><span class="o">.</span><span class="n">compute_agreement_map</span><span class="p">(</span>
    <span class="n">benchmark_map</span><span class="o">=</span><span class="n">benchmark</span><span class="p">,</span>
    <span class="n">comparison_function</span><span class="o">=</span><span class="s1">&#39;pairing_dict&#39;</span><span class="p">,</span>
    <span class="n">allow_candidate_values</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span>
    <span class="n">allow_benchmark_values</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>
<span class="p">)</span>

<span class="n">agreement_map</span><span class="o">.</span><span class="n">gval</span><span class="o">.</span><span class="n">cat_plot</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;Agreement Map&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;matplotlib.collections.QuadMesh at 0x7f2a14f90a00&gt;
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/SphinxTutorial_37_1.png" src="_images/SphinxTutorial_37_1.png" />
</div>
</div>
</section>
<section id="Registration-of-Custom-Functions">
<h3>Registration of Custom Functions<a class="headerlink" href="#Registration-of-Custom-Functions" title="Permalink to this heading"></a></h3>
<p>In this case we register the arbitrary pairing function <code class="docutils literal notranslate"><span class="pre">multiply</span></code> with the name “multi” and then vectorize it. <code class="docutils literal notranslate"><span class="pre">Multiply</span></code> can also be passed in as a function in the <code class="docutils literal notranslate"><span class="pre">comparison_function</span></code> argument</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">gval</span><span class="w"> </span><span class="kn">import</span> <span class="n">Comparison</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">numbers</span><span class="w"> </span><span class="kn">import</span> <span class="n">Number</span>

<span class="nd">@Comparison</span><span class="o">.</span><span class="n">register_function</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;multi&#39;</span><span class="p">,</span> <span class="n">vectorize_func</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">multiply</span><span class="p">(</span><span class="n">c</span><span class="p">:</span> <span class="n">Number</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="n">Number</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Number</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">c</span> <span class="o">*</span> <span class="n">b</span>

<span class="n">agreement_map</span> <span class="o">=</span> <span class="n">candidate</span><span class="o">.</span><span class="n">gval</span><span class="o">.</span><span class="n">compute_agreement_map</span><span class="p">(</span>
    <span class="n">benchmark_map</span><span class="o">=</span><span class="n">benchmark</span><span class="p">,</span>
    <span class="n">comparison_function</span><span class="o">=</span><span class="s2">&quot;multi&quot;</span>
<span class="p">)</span>

<span class="n">agreement_map</span><span class="o">.</span><span class="n">gval</span><span class="o">.</span><span class="n">cat_plot</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;Agreement Map&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;matplotlib.collections.QuadMesh at 0x7f2a14e29660&gt;
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/SphinxTutorial_40_1.png" src="_images/SphinxTutorial_40_1.png" />
</div>
</div>
<p>A user can also pick which candidate values or benchmark values to use by providing lists to the <code class="docutils literal notranslate"><span class="pre">allow_candidate_values</span></code> and <code class="docutils literal notranslate"><span class="pre">allow_benchmark_values</span></code> arguments. Finally, a user can choose to write nodata to unmasked datasets with the <code class="docutils literal notranslate"><span class="pre">nodata</span></code> value, or to masked/scaled datasets with <code class="docutils literal notranslate"><span class="pre">encode_nodata</span></code>.</p>
<section id="id1">
<h4>Cross-tabulation Table<a class="headerlink" href="#id1" title="Permalink to this heading"></a></h4>
<p>A cross-tabulation table can be made using an agreement map as follows. (In this particular case the table reflects agreement values made in the previous example.)</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">crosstab_table_allow</span> <span class="o">=</span> <span class="n">agreement_map</span><span class="o">.</span><span class="n">gval</span><span class="o">.</span><span class="n">compute_crosstab</span><span class="p">()</span>
<span class="n">crosstab_table_allow</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>band</th>
      <th>candidate_values</th>
      <th>benchmark_values</th>
      <th>agreement_values</th>
      <th>counts</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>11526204.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1</td>
      <td>1.0</td>
      <td>2.0</td>
      <td>2.0</td>
      <td>679211.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1</td>
      <td>2.0</td>
      <td>2.0</td>
      <td>4.0</td>
      <td>2624301.0</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
</section>
<section id="id2">
<h4>Metric Table<a class="headerlink" href="#id2" title="Permalink to this heading"></a></h4>
<p>Although all categorical metrics are computed by default if no argument is provided, <code class="docutils literal notranslate"><span class="pre">metrics</span></code> can also take a list of the desired metrics and will only return metrics in this list.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">metric_table_select</span> <span class="o">=</span> <span class="n">crosstab_table</span><span class="o">.</span><span class="n">gval</span><span class="o">.</span><span class="n">compute_categorical_metrics</span><span class="p">(</span>
    <span class="n">negative_categories</span><span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
    <span class="n">positive_categories</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2</span><span class="p">],</span>
    <span class="n">metrics</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;true_positive_rate&#39;</span><span class="p">,</span> <span class="s1">&#39;prevalence&#39;</span><span class="p">]</span>
<span class="p">)</span>
<span class="n">metric_table_select</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>band</th>
      <th>fn</th>
      <th>fp</th>
      <th>tn</th>
      <th>tp</th>
      <th>true_positive_rate</th>
      <th>prevalence</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>639227.0</td>
      <td>512277.0</td>
      <td>10345720.0</td>
      <td>2473405.0</td>
      <td>0.794635</td>
      <td>0.222798</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<p>Just like registering comparison functions, you are able to register a metric function on both a method and a class of functions. Below is registering a metric function:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">gval</span><span class="w"> </span><span class="kn">import</span> <span class="n">CatStats</span>

<span class="nd">@CatStats</span><span class="o">.</span><span class="n">register_function</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;error_balance&quot;</span><span class="p">,</span> <span class="n">vectorize_func</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">error_balance</span><span class="p">(</span><span class="n">fp</span><span class="p">:</span> <span class="n">Number</span><span class="p">,</span> <span class="n">fn</span><span class="p">:</span> <span class="n">Number</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">fp</span> <span class="o">/</span> <span class="n">fn</span>
</pre></div>
</div>
</div>
<p>The following is registering a class of metric functions. In this case, the names associated with each function will respond to each method’s name.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nd">@CatStats</span><span class="o">.</span><span class="n">register_function_class</span><span class="p">(</span><span class="n">vectorize_func</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">MetricFunctions</span><span class="p">:</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">arbitrary1</span><span class="p">(</span><span class="n">tp</span><span class="p">:</span> <span class="n">Number</span><span class="p">,</span> <span class="n">tn</span><span class="p">:</span> <span class="n">Number</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">tp</span> <span class="o">+</span> <span class="n">tn</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">arbitrary2</span><span class="p">(</span><span class="n">tp</span><span class="p">:</span> <span class="n">Number</span><span class="p">,</span> <span class="n">tn</span><span class="p">:</span> <span class="n">Number</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">tp</span> <span class="o">-</span> <span class="n">tn</span>
</pre></div>
</div>
</div>
<p>All of these functions are now callable as metrics:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">metric_table_register</span> <span class="o">=</span> <span class="n">crosstab_table</span><span class="o">.</span><span class="n">gval</span><span class="o">.</span><span class="n">compute_categorical_metrics</span><span class="p">(</span>
    <span class="n">negative_categories</span><span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">positive_categories</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2</span><span class="p">],</span>
    <span class="n">metrics</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;error_balance&#39;</span><span class="p">,</span> <span class="s1">&#39;arbitrary1&#39;</span><span class="p">,</span> <span class="s1">&#39;arbitrary2&#39;</span><span class="p">]</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">metric_table_register</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>band</th>
      <th>fn</th>
      <th>fp</th>
      <th>tn</th>
      <th>tp</th>
      <th>error_balance</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>639227.0</td>
      <td>512277.0</td>
      <td>NaN</td>
      <td>2473405.0</td>
      <td>0.801401</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
</section>
</section>
</section>
<section id="Save-Output">
<h2>Save Output<a class="headerlink" href="#Save-Output" title="Permalink to this heading"></a></h2>
<p>Finally, a user can take the results and save them to a directory of their choice. The following is an example of saving the agreement map and then the metric table:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[20]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># output agreement map</span>
<span class="n">agreement_file</span> <span class="o">=</span> <span class="s1">&#39;agreement_map.tif&#39;</span>
<span class="n">metric_file</span> <span class="o">=</span> <span class="s1">&#39;metric_file.csv&#39;</span>

<span class="n">agreement_map</span><span class="o">.</span><span class="n">rio</span><span class="o">.</span><span class="n">to_raster</span><span class="p">(</span><span class="n">agreement_file</span><span class="p">)</span>
<span class="n">metric_table</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">metric_file</span><span class="p">)</span>
</pre></div>
</div>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="tutorials.html" class="btn btn-neutral float-left" title="Tutorials" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="SphinxMulticatTutorial.html" class="btn btn-neutral float-right" title="Multi-Class Categorical Comparisons" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, NOAA-OWP.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>